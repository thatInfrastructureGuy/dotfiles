######################## Basic ###################################
## Locale
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

## Editor
export EDITOR=nvim
export KUBE_EDITOR=${EDITOR}
alias vim='nvim'
##################################################################

{{ if eq .chezmoi.os "darwin" -}}
################ OS SPECIFIC #####################################
export BASH_SILENCE_DEPRECATION_WARNING=1
{{- end }}

## Based on: https://pkg.go.dev/os#UserConfigDir
{{ if eq .chezmoi.os "darwin" -}}
export XDG_CONFIG_HOME="$HOME/Library/Application Support"
{{ else if eq .chezmoi.os "linux" -}}
export XDG_CONFIG_HOME="$HOME/.config"
{{- end }}
##################################################################

############### https://github.com/homebrew/brew #################
# Based on https://docs.brew.sh/Installation

{{ if and (eq .chezmoi.os "darwin") (eq .chezmoi.arch "arm64") -}}
BREW_PREFIX="/opt/homebrew"
{{ else if and (eq .chezmoi.os "darwin") (eq .chezmoi.arch "amd64") -}}
BREW_PREFIX="/usr/local"
{{ else if eq .chezmoi.os "linux" -}}
BREW_PREFIX="/home/linuxbrew/.linuxbrew"
{{- end }}

BREW="${BREW_PREFIX}/bin/brew"
if command -V ${BREW} > /dev/null
then
    eval "$(${BREW} shellenv)"
fi
##################################################################

###################### Yubikey Git ###############################
# git settings
unset SSH_AGENT_PID
export SSH_AUTH_SOCK=$(gpgconf --list-dirs agent-ssh-socket)

# git commit with signing
export GPG_TTY=$(tty)

# reconnect yubikey
gpg-tty() { gpg-connect-agent updatestartuptty /bye &> /dev/null; };
gpg-tty
##################################################################

####################### Prettify #################################
alias ls='ls -GF'
alias grep="grep --recursive --color -in --exclude-dir=.git"
cd() { builtin cd "$@" && pwd && ls; };

## Terminal Settings
export TERM="xterm-256color"
##################################################################


######################## Kubernetes ##############################
alias k='kubectl --namespace'

if command -V kubectl > /dev/null
then
    source <(kubectl completion bash)
fi
##################################################################

######################## Golang ##################################
export GOPATH=~/go
export GOBIN=$GOPATH/bin
export PATH=$PATH:$GOBIN
##################################################################

####################### Bash History Tweaks ######################
# Append to history. Dont overwrite
shopt -s histappend
export HISTSIZE=2000
export HISTFILESIZE=5000
# Ignore dups and ignore starting with space
export HISTCONTROL=ignoreboth:erasedups
# Show date/time in bash history
export HISTTIMEFORMAT="%m/%d/%y %T "
##################################################################


############### https://github.com/naggie/dstask #################
alias t="dstask"
##################################################################

############# https://github.com/knqyf263/pet ####################
alias pet="pet --config "${XDG_CONFIG_HOME}"/pet/config.toml"
function add_to_pet() {
  PREV=$(echo `history | tail -n2 | head -n1` | cut -d' ' -f4-)
  sh -c "pet --config "${XDG_CONFIG_HOME}"/pet/config.toml new `printf %q "$PREV"`"
}
##################################################################

#################### https://ohmyposh.dev ########################
if command -V oh-my-posh > /dev/null
then
    eval "$(oh-my-posh --init --shell bash --config "${XDG_CONFIG_HOME}"/ohmyposh/star.omp.json)"
fi
##################################################################

############ https://github.com/gsamokovarov/jump ################
if command -V jump > /dev/null
then
    eval "$(jump shell)"
fi
##################################################################

############### https://github.com/junegunn/fzf ##################
if command -V fzf > /dev/null
then
    eval "$(fzf --bash)"
fi
##################################################################

############# https://github.com/BurntSushi/ripgrep ##############
if command -V rg > /dev/null
then
    export FZF_DEFAULT_COMMAND='rg --files --no-ignore-vcs --hidden'
fi
##################################################################

############# https://github.com/vimwiki/vimwiki #################
# launch diary from command line:
alias diary='${EDITOR} -c ":VimwikiMakeDiaryNote"'

# launch index page from command line
alias vw='${EDITOR} -c ":VimwikiIndex"'

# convert a file into zettel
alias vz='${EDITOR} -c ZettelCapture'
##################################################################
